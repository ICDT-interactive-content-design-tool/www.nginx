"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3181],{3181:(z,P,s)=>{s.d(P,{q:()=>w});var u=s(467),p=s(5972),U=s(6081),E=s(2635),k=s(3753),S=s(5862);function M(a){a.params=a.params||{},(0,p.Ll)({url:"api/BoardShareUser/AddUpdate",params:{board_id:a.params.board_id||null,emailaddr:a.params.emailaddr||null,v_sharepermission:a.params.v_sharepermission||null,createdby:a.params.userid||null,modifiedby:a.params.userid||null},success:t=>{"function"==typeof a.callback&&a.callback(t.data||null)},error:t=>{"function"==typeof a.callback&&a.callback(),console.error(t)},loading:a.loading,loadingController:a.loadingController})}var b=s(5414),y=s(8833),O=s(4552),B=s(4668),e=s(4438),d=s(6637),f=s(9417),D=s(31);function I(a,t){1&a&&e.nrm(0,"ion-icon",7)}function L(a,t){1&a&&e.nrm(0,"ion-icon",24)}function T(a,t){1&a&&e.nrm(0,"ion-icon",25)}function G(a,t){if(1&a){const h=e.RV6();e.j41(0,"ion-item",19)(1,"ion-avatar"),e.nrm(2,"img",26),e.k0s(),e.j41(3,"ion-label",27),e.EFF(4),e.k0s(),e.j41(5,"ion-button",28),e.bIt("click",function(r){const n=e.eBV(h).$implicit,l=e.XpG();return e.Njj(l.presentPopoverLookupSharePermission(r,n.emailaddr))}),e.j41(6,"ion-label"),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.nrm(9,"ion-icon",29),e.k0s()()}if(2&a){let h,o,r;const n=t.$implicit,l=e.XpG();e.Y8G("disabled",l.isDisabled4Only),e.R7$(2),e.Y8G("src",null!==(h=n.profilephoto?l.readfileuploadurl+n.profilephoto:null)&&void 0!==h?h:"../../../assets/image/user-avatar-default.png",e.B4B),e.R7$(2),e.JRh(null!==(o=n.fullname)&&void 0!==o?o:n.emailaddr),e.R7$(3),e.JRh(null!==(r=n.v_sharepermission_title)&&void 0!==r?r:e.bMT(8,4,"View"))}}let w=(()=>{var a;class t{constructor(o,r,n,l){this.modalController=o,this.popoverController=r,this.toastController=n,this.loadingController=l,this.b=0,this.v_share=B.z,this.dataForm={},this.board={},this.boardShare={},this.boardShareUsers=[],this.isfullscreen=!1,this.readfileuploadurl="",this.fileurl="",this.appsettings={}}ngOnInit(){var o=this;this.isfullscreen=window.document.body.classList.contains("modal-fullscreen"),(0,u.A)(function*(){o.appsettings=yield(0,p.AC)(),o.appsettings.madonvi&&(o.user=yield(0,E.Nk)(),o.readfileuploadurl=o.appsettings.readfileuploadurl||"",o.refreshData())})()}refreshData(){var o;(0,U.qU)({loadingController:this.loadingController,params:{userid:null===(o=this.user)||void 0===o?void 0:o.userid,board_id:this.b},callback:r=>{this.board=r||{},this.board.board_id&&(this.GetBoardShare(),this.GetBoardShareUser())}})}toggleFullScreen(){this.isfullscreen?window.document.body.classList.remove("modal-fullscreen"):window.document.body.classList.add("modal-fullscreen"),this.isfullscreen=window.document.body.classList.contains("modal-fullscreen")}close(){return this.modalController.dismiss(null,"cancel")}changeEmails(o){var r;this.dataForm.emailaddrs=((null==o||null===(r=o.target)||void 0===r?void 0:r.value)||"").replace(/[^a-zA-Z0-9\@\;\ \-\_\.]+/g,"").replace(/\s+/," ").trim().replace(/\ \;/g,";").replace(/\;\ /g,";").replace(/\ /g,";").replace(/\;+/g,";").split(";").map(n=>{let l=n.match(/^[a-zA-Z0-9\.\-\_]+@[a-zA-Z0-9\-\_]+\.[a-zA-Z0-9\-\_]+((\.[a-zA-Z0-9\-\_]+)+)?$/);return l?l[0]:null}).filter(n=>!!n).filter((n,l,i)=>i.indexOf(n)==l).join("; ")}keypressEmails(o){var r,l,n=o.keyCode||o.which||o.charCode||0;n!=S.r_I.Enter&&n!=S.r_I.Escape||(null===(l=o.target)||void 0===l||l.blur(),this.submitEmails()),null!==(r=o.key)&&void 0!==r&&r.match(/[^a-zA-Z0-9\@\;\ \-\_\.]/)&&(null==o||o.preventDefault(),null==o||o.stopPropagation())}submitEmails(o){this.dataForm.emailaddrs&&(this.AddUpdateBoardShareUser_Recursive(this.dataForm.emailaddrs.replace(/\s+/g,"").split(";")),this.dataForm.emailaddrs="")}presentPopoverLookupShare(o){var r=this;return(0,u.A)(function*(){const n=yield r.popoverController.create({component:k.t,componentProps:{selectedId:r.boardShare.v_share,lookup_key:"v_share"},event:o,dismissOnSelect:!1,animated:!1,side:"bottom",alignment:"start"});n.onDidDismiss().then(l=>{var i,c,m;"confirm"==l.role&&(Object.assign(r.boardShare,{v_share:null===(i=l.data)||void 0===i?void 0:i.lookup_value,v_share_title:null===(c=l.data)||void 0===c?void 0:c.lookup_title}),r.AddUpdateBoardShare(null===(m=l.data)||void 0===m?void 0:m.lookup_value))}),n.present()})()}presentPopoverLookupSharePermission(o,r){var n=this;return(0,u.A)(function*(){var l;const c=yield n.popoverController.create({component:k.t,componentProps:{selectedId:null===(l=n.boardShareUsers.find(m=>m.emailaddr==r))||void 0===l?void 0:l.v_sharepermission,lookup_key:"v_sharepermission",lookups_d2:[{lookup_value:-1,lookup_title:"X\xf3a",color:"danger"}]},event:o,dismissOnSelect:!1,animated:!1,alignment:"end",side:"bottom"});c.onDidDismiss().then(m=>{var g;"confirm"==m.role&&(n.boardShareUsers.filter(_=>_.emailaddr==r).forEach(_=>{var v,C;Object.assign(_,{v_sharepermission:null===(v=m.data)||void 0===v?void 0:v.lookup_value,v_sharepermission_title:null===(C=m.data)||void 0===C?void 0:C.lookup_title})}),n.AddUpdateBoardShareUser(r,null===(g=m.data)||void 0===g?void 0:g.lookup_value))}),c.present()})()}GetBoardShare(){var o=this;return(0,u.A)(function*(){var r;!function F(a){a.params=a.params||{},(0,p.hm)({url:"api/BoardShare/Get",params:{getby:a.params.userid||null,boardshare_id:a.params.boardshare_id||null,board_id:a.params.board_id||null,v_share:a.params.v_share||null},success:t=>{"function"==typeof a.callback&&a.callback(t.data||null)},error:t=>{"function"==typeof a.callback&&a.callback(),console.error(t)},loading:a.loading,loadingController:a.loadingController})}({loadingController:o.loadingController,params:{userid:null===(r=o.user)||void 0===r?void 0:r.userid,board_id:o.b},callback:n=>{o.boardShare=n||{},o.isDisabled4Only=!o.boardShare.v_share||o.boardShare.v_share==B.z.ONLY_ME}})})()}AddUpdateBoardShare(o){var r=this;return(0,u.A)(function*(){var n;if(!o||o<=0)return r.DeleteBoardShare();!function j(a){a.params=a.params||{},(0,p.Ll)({url:"api/BoardShare/AddUpdate",params:{board_id:a.params.board_id||null,v_share:a.params.v_share||null,createdby:a.params.userid||null,modifiedby:a.params.userid||null},success:t=>{"function"==typeof a.callback&&a.callback(t.data||null)},error:t=>{"function"==typeof a.callback&&a.callback(),console.error(t)},loading:a.loading,loadingController:a.loadingController})}({loadingController:r.loadingController,params:{userid:null===(n=r.user)||void 0===n?void 0:n.userid,board_id:r.b,v_share:o},callback:l=>{0==(null==l?void 0:l.returncode)?r.GetBoardShare():(0,b.c)(r.toastController,{},l).then(i=>i.present())}})})()}DeleteBoardShare(){var o=this;return(0,u.A)(function*(){var r;!function $(a){a.params=a.params||{},(0,p.sj)({url:"api/BoardShare/Delete",params:{deleteby:a.params.userid||null,boardshare_id:a.params.boardshare_id||null,board_id:a.params.board_id||null},success:t=>{"function"==typeof a.callback&&a.callback(t.data||null)},error:t=>{"function"==typeof a.callback&&a.callback(),console.error(t)},loading:a.loading,loadingController:a.loadingController})}({loadingController:o.loadingController,params:{userid:null===(r=o.user)||void 0===r?void 0:r.userid,board_id:o.b},callback:n=>{0==(null==n?void 0:n.returncode)?o.GetBoardShare():(0,b.c)(o.toastController,{},n).then(l=>l.present())}})})()}GetBoardShareUser(){var o=this;return(0,u.A)(function*(){var r;!function R(a){a.params=a.params||{},(0,p.hm)({url:"api/BoardShareUser/Get",params:{getby:a.params.userid||null,boardshareuser_id:a.params.boardshareuser_id||null,board_id:a.params.board_id||null,emailaddr:a.params.emailaddr||null,v_sharepermission:a.params.v_sharepermission||null},success:t=>{"function"==typeof a.callback&&a.callback(t.data||null)},error:t=>{"function"==typeof a.callback&&a.callback(),console.error(t)},loading:a.loading,loadingController:a.loadingController})}({loadingController:o.loadingController,params:{userid:null===(r=o.user)||void 0===r?void 0:r.userid,board_id:o.b},callback:n=>{o.boardShareUsers=n||[]}})})()}AddUpdateBoardShareUser_Recursive(o){var r=this;return(0,u.A)(function*(){let n=l=>{var i;l&&M({loadingController:r.loadingController,params:{userid:null===(i=r.user)||void 0===i?void 0:i.userid,board_id:r.b,emailaddr:l,v_sharepermission:1},callback:c=>{o.length?n(null==o?void 0:o.shift()):0==(null==c?void 0:c.returncode)?r.GetBoardShareUser():(0,b.c)(r.toastController,{},c).then(m=>m.present())}})};n(o.shift())})()}AddUpdateBoardShareUser(o,r){var n=this;return(0,u.A)(function*(){var l;if(o){if(!r||r<=0)return n.DeleteBoardShareUser(o);M({loadingController:n.loadingController,params:{userid:null===(l=n.user)||void 0===l?void 0:l.userid,board_id:n.b,emailaddr:o,v_sharepermission:r},callback:i=>{0==(null==i?void 0:i.returncode)?n.GetBoardShareUser():(0,b.c)(n.toastController,{},i).then(c=>c.present())}})}})()}DeleteBoardShareUser(o){var r=this;return(0,u.A)(function*(){var n;o&&function A(a){a.params=a.params||{},(0,p.sj)({url:"api/BoardShareUser/Delete",params:{deleteby:a.params.userid||null,boardshareuser_id:a.params.boardshareuser_id||null,board_id:a.params.board_id||null,emailaddr:a.params.emailaddr||null},success:t=>{"function"==typeof a.callback&&a.callback(t.data||null)},error:t=>{"function"==typeof a.callback&&a.callback(),console.error(t)},loading:a.loading,loadingController:a.loadingController})}({loadingController:r.loadingController,params:{userid:null===(n=r.user)||void 0===n?void 0:n.userid,board_id:r.b,emailaddr:o},callback:l=>{0==(null==l?void 0:l.returncode)?r.GetBoardShareUser():(0,b.c)(r.toastController,{},l).then(i=>i.present())}})})()}copyLink(o){var r=this;return(0,u.A)(function*(){let n=r.appsettings.weburl+y._.VIEWER+"?"+jQuery.param({b:r.b});(0,O.lW)(n)?(r.isCopiedLink=!0,r.isCopiedEmbed=!1):(0,b.c)(r.toastController,{message:"Sao ch\xe9p l\u1ed7i!"}).then(l=>l.present())})()}copyEmbed(o){var r=this;return(0,u.A)(function*(){let l=`<iframe src="${r.appsettings.weburl+y._.EMBED+"?"+jQuery.param({b:r.b})}" width="${r.board.size_width||1280}" height="${r.board.size_height||720}" frameborder="0" allowfullscreen webkitallowfullscreen allowtransparency="true" allow="fullscreen" style="display: block; margin: auto; border: 1px dashed rgba(0,0,0,0.1);"></iframe>`;(0,O.lW)(l)?(r.isCopiedLink=!1,r.isCopiedEmbed=!0):(0,b.c)(r.toastController,{message:"Sao ch\xe9p l\u1ed7i!"}).then(i=>i.present())})()}}return(a=t).\u0275fac=function(o){return new(o||a)(e.rXU(d.W3),e.rXU(d.IE),e.rXU(d.K_),e.rXU(d.Xi))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-modal-board-share"]],inputs:{b:"b"},decls:51,vars:26,consts:[["color","primary"],["slot","end"],["color","dark",1,"d-none","d-md-block",3,"click"],[3,"src"],["color","dark",3,"click"],["src","../../../assets/icon/16x16/close.svg"],["lines","none","detail","false","button","",3,"click"],["slot","start","name","lock-closed-outline",1,"mr-3"],[1,"d-flex","align-items-center"],[1,"mr-2"],["src","../../../assets/icon/16x16/chevron-down.svg",1,"fs-12"],[1,"fs-12","mt-1"],[1,"px-3","pt-2","pb-3"],[1,"form-group"],[1,"input-group"],["type","text","placeholder","email@example.com; email2@example.com; ...",1,"form-control",3,"change","keypress","disabled","ngModel"],[1,"input-group-append"],["type","button",1,"btn",3,"click","disabled"],[1,"mb-0","mt-3"],["button","","detail","false",3,"disabled"],[1,"p-2"],["shape","round","fill","outline",1,"m-1",3,"click"],["slot","start","src","../../../assets/icon/24x24/attach.svg",1,"fs-24"],["slot","start","src","../../../assets/icon/24x24/embed.svg",1,"fs-24"],["slot","start","name","people-outline",1,"mr-3"],["slot","start","name","globe-outline",1,"mr-3"],["onerror","errorAvatar(this)",3,"src"],[1,"ml-3"],["slot","end","size","default","color","dark","fill","clear",1,"m-0",3,"click"],["slot","end","src","../../../assets/icon/16x16/chevron-down.svg",1,"fs-10"]],template:function(o,r){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"ion-text",0),e.EFF(6),e.k0s()(),e.j41(7,"ion-buttons",1)(8,"ion-button",2),e.bIt("click",function(){return r.toggleFullScreen()}),e.nrm(9,"ion-icon",3),e.k0s(),e.j41(10,"ion-button",4),e.bIt("click",function(){return r.close()}),e.nrm(11,"ion-icon",5),e.k0s()()(),e.j41(12,"ion-toolbar")(13,"ion-item",6),e.bIt("click",function(l){return r.presentPopoverLookupShare(l)}),e.DNE(14,I,1,0,"ion-icon",7)(15,L,1,0)(16,T,1,0),e.j41(17,"ion-label")(18,"div",8)(19,"b",9),e.EFF(20),e.k0s(),e.nrm(21,"ion-icon",10),e.k0s(),e.j41(22,"div",11),e.EFF(23),e.k0s()()(),e.j41(24,"div",12)(25,"div",13)(26,"div",14)(27,"input",15),e.bIt("change",function(l){return r.changeEmails(l)})("keypress",function(l){return r.keypressEmails(l)}),e.k0s(),e.j41(28,"div",16)(29,"button",17),e.bIt("click",function(l){return r.submitEmails(l)}),e.EFF(30),e.nI1(31,"translate"),e.k0s()()()(),e.nrm(32,"hr"),e.j41(33,"label",18),e.EFF(34),e.nI1(35,"translate"),e.k0s()()()(),e.j41(36,"ion-content")(37,"ion-list"),e.Z7z(38,G,10,6,"ion-item",19,e.fX1),e.k0s()(),e.j41(40,"ion-footer",20)(41,"ion-button",21),e.bIt("click",function(l){return r.copyLink(l)}),e.nrm(42,"ion-icon",22),e.j41(43,"ion-label"),e.EFF(44),e.nI1(45,"translate"),e.k0s()(),e.j41(46,"ion-button",21),e.bIt("click",function(l){return r.copyEmbed(l)}),e.nrm(47,"ion-icon",23),e.j41(48,"ion-label"),e.EFF(49),e.nI1(50,"translate"),e.k0s()()()),2&o&&(e.R7$(3),e.SpI("",e.bMT(4,16,"Share"),": "),e.R7$(3),e.JRh(r.board.board_title),e.R7$(3),e.Y8G("src",r.isfullscreen?"assets/icon/16x16/fullscreen-exit.svg":"assets/icon/16x16/fullscreen.svg"),e.R7$(5),e.vxM(14,r.boardShare.v_share&&r.boardShare.v_share!=r.v_share.ONLY_ME?r.boardShare.v_share==r.v_share.ONLY_MEMBER?15:r.boardShare.v_share==r.v_share.EVERYONE_HAS_LINK?16:-1:14),e.R7$(6),e.JRh(r.boardShare.v_share_title),e.R7$(3),e.JRh(r.boardShare.v_share_note),e.R7$(4),e.Y8G("disabled",!!r.isDisabled4Only)("ngModel",r.dataForm.emailaddrs),e.R7$(2),e.Y8G("disabled",!!r.isDisabled4Only),e.R7$(),e.JRh(e.bMT(31,18,"Add")),e.R7$(3),e.HbH(r.isDisabled4Only?"disabled":""),e.R7$(),e.Lme("",e.bMT(35,20,"SharedMembership")," (",r.boardShareUsers.length,")"),e.R7$(4),e.Dyx(r.boardShareUsers),e.R7$(6),e.JRh(e.bMT(45,22,r.isCopiedLink?"Copied":"CopyLink")),e.R7$(5),e.JRh(e.bMT(50,24,r.isCopiedEmbed?"Copied":"CopyEmbed")))},dependencies:[f.me,f.BC,f.vS,d.mC,d.Jm,d.QW,d.W9,d.M0,d.eU,d.iq,d.uz,d.he,d.nf,d.IO,d.BC,d.ai,D.D9],styles:["ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{border-radius:50%;padding:8px;margin:0 1rem 0 0;background-color:#faebd7;color:var(--ion-color-primary)}ion-toolbar[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:#f5f5f5}ion-footer[_ngcontent-%COMP%]{box-shadow:none;border:0;--box-shadow: none;--border-width: 0}ion-footer[_ngcontent-%COMP%]:before{display:none}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:234px;--border-width: 1px;--border-color: #747775;--background: transparent;--color: var(--ion-color-primary);--background-hover: var(--ion-color-primary-tint);--background-hover-opacity: 1;--color-hover: #fff;--background-focused: var(--ion-color-primary-shade);--background-focused-opacity: 1;--color-focused: #fff;--background-activated: var(--ion-color-primary);--background-activated-opacity: 1;--color-activated: #fff}.disabled[_ngcontent-%COMP%]{opacity:.65}.input-group[_ngcontent-%COMP%]{--color: #eee}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]{margin-left:.5rem}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:3rem;min-height:3rem;padding:0 1rem;border:0;border-radius:.25rem;text-align:center;line-height:0;vertical-align:middle;background-color:var(--ion-color-tertiary);color:var(--ion-color-tertiary-contrast)}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:var(--ion-color-tertiary-shade)}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .custom-select[_ngcontent-%COMP%]{height:3rem;padding:.25rem .5rem;border-color:var(--color, #4D4F60);color:var(--ion-text-color, #000);background-color:var(--ion-background-color, #fff)}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .custom-select[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#5f6ce1}.btn-share[_ngcontent-%COMP%]{padding:.25rem 0;margin:0;border:0;font-size:1rem;background-color:transparent;color:var(--ion-text-color, #000);outline:none;box-shadow:none}.btn-share[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{vertical-align:middle;font-size:1.5rem}.btn-share[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]:last-child{font-size:1rem}.btn-share[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 .5rem;vertical-align:middle}.share-member-action[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .share-member-action[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.share-member-action[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%] + ion-icon[_ngcontent-%COMP%]{margin-left:.5rem}hr[_ngcontent-%COMP%]{margin:0}"]}),t})()}}]);