"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6169],{5178:(j,S,d)=>{d.d(S,{Q:()=>y});const c=[null,"jpg","lvb","svg","lvm","zip",null,"m4a","xlsx","jpe","bmp","ppt","pptx","js","jif",null,null,null,null,null,"jpeg",null,null,null,"jfif",null,null,null,null,null,"pdf","json",null,null,null,"apng",null,null,null,null,"gif","png","pjp",null,null,null,"ico",null,"webp",null,"mp3","mp4","xls","avif",null,null,null,"cur",null,null,null,null,null,null,null,null,null,null,"tif",null,"doc","docx",null,null,null,null,null,null,null,"tiff","pjpeg",null,null,null,null,null,null,null,null,null,"wav","htm","html"];var f=d(6348);const y=M=>new Promise((C,k)=>{fetch(M).then(h=>h.arrayBuffer()).then(h=>{for(var m=new Uint8Array(h),b=m[m.length-1],v=c[b]||"",g=0,O=m.length-1;g<O;g++)g%b==0&&(m[g]=Math.abs(255-m[g]));m=m.slice(0,m.length-1),C({ext:v,file:new File([m],(M.split("/").pop()||"anhbaluntit.lvm").replace(new RegExp(".lvm$"),`.${v}`),{type:f.lookup(v)||"application/octet-stream"})})}).catch(()=>{k()})})},1632:(j,S,d)=>{d.d(S,{U:()=>z});var c=d(467),f=d(5972),y=d(5781),M=d(2635),C=d(3753),k=d(8408),h=d(5414),m=d(8833),b=d(4552),v=d(4668);function F(l){l.params=l.params||{},(0,f.Ll)({url:"api/MediaShareUser/AddUpdate",params:{media_id:l.params.media_id||null,emailaddr:l.params.emailaddr||null,v_sharepermission:l.params.v_sharepermission||null,createdby:l.params.userid||null,modifiedby:l.params.userid||null},success:o=>{"function"==typeof l.callback&&l.callback(o.data||null)},error:o=>{"function"==typeof l.callback&&l.callback(),console.error(o)},loading:l.loading,loadingController:l.loadingController})}var e=d(4438),s=d(6637),P=d(9417),w=d(31);function L(l,o){1&l&&e.nrm(0,"ion-icon",7)}function G(l,o){1&l&&e.nrm(0,"ion-icon",24)}function T(l,o){1&l&&e.nrm(0,"ion-icon",25)}function x(l,o){if(1&l&&(e.j41(0,"ion-item",19)(1,"ion-avatar"),e.nrm(2,"img",26),e.k0s(),e.j41(3,"ion-label",27),e.EFF(4),e.k0s()()),2&l){let _,n;const a=o.$implicit,r=e.XpG();e.Y8G("disabled",r.isDisabled4Only),e.R7$(2),e.Y8G("src",null!==(_=a.profilephoto?r.readfileuploadurl+a.profilephoto:null)&&void 0!==_?_:"../../../assets/image/user-avatar-default.png",e.B4B),e.R7$(2),e.JRh(null!==(n=a.fullname)&&void 0!==n?n:a.emailaddr)}}let z=(()=>{var l;class o{constructor(n,a,r,i){this.modalController=n,this.popoverController=a,this.toastController=r,this.loadingController=i,this.m=0,this.v_share=v.z,this.dataForm={},this.media={},this.mediaShare={},this.mediaShareUsers=[],this.isfullscreen=!1,this.readfileuploadurl="",this.fileurl="",this.appsettings={}}ngOnInit(){var n=this;this.isfullscreen=window.document.body.classList.contains("modal-fullscreen"),(0,c.A)(function*(){n.appsettings=yield(0,f.AC)(),n.appsettings.madonvi&&(n.user=yield(0,M.Nk)(),n.readfileuploadurl=n.appsettings.readfileuploadurl||"",n.refreshData())})()}refreshData(){var n;(0,y.e6)({loadingController:this.loadingController,params:{userid:null===(n=this.user)||void 0===n?void 0:n.userid,media_id:this.m},callback:a=>{this.media=a||{},this.media.media_id&&(this.GetMediaShare(),this.GetMediaShareUser())}})}toggleFullScreen(){this.isfullscreen?window.document.body.classList.remove("modal-fullscreen"):window.document.body.classList.add("modal-fullscreen"),this.isfullscreen=window.document.body.classList.contains("modal-fullscreen")}close(){return this.modalController.dismiss(null,"cancel")}changeEmails(n){var a;this.dataForm.emailaddrs=((null==n||null===(a=n.target)||void 0===a?void 0:a.value)||"").replace(/[^a-zA-Z0-9\@\;\ \-\_\.]+/g,"").replace(/\s+/," ").trim().replace(/\ \;/g,";").replace(/\;\ /g,";").replace(/\ /g,";").replace(/\;+/g,";").split(";").map(r=>{let i=r.match(/^[a-zA-Z0-9\.\-\_]+@[a-zA-Z0-9\-\_]+\.[a-zA-Z0-9\-\_]+((\.[a-zA-Z0-9\-\_]+)+)?$/);return i?i[0]:null}).filter(r=>!!r).filter((r,i,t)=>t.indexOf(r)==i).join("; ")}keypressEmails(n){var a,i,r=n.keyCode||n.which||n.charCode||0;r!=k.r_I.Enter&&r!=k.r_I.Escape||(null===(i=n.target)||void 0===i||i.blur(),this.submitEmails()),null!==(a=n.key)&&void 0!==a&&a.match(/[^a-zA-Z0-9\@\;\ \-\_\.]/)&&(null==n||n.preventDefault(),null==n||n.stopPropagation())}submitEmails(n){this.dataForm.emailaddrs&&(this.AddUpdateMediaShareUser_Recursive(this.dataForm.emailaddrs.replace(/\s+/g,"").split(";")),this.dataForm.emailaddrs="")}presentPopoverLookupShare(n){var a=this;return(0,c.A)(function*(){const r=yield a.popoverController.create({component:C.t,componentProps:{selectedId:a.mediaShare.v_share,lookup_key:"v_share"},event:n,dismissOnSelect:!1,animated:!1,side:"bottom",alignment:"start"});r.onDidDismiss().then(i=>{var t,u,p;"confirm"==i.role&&(Object.assign(a.mediaShare,{v_share:null===(t=i.data)||void 0===t?void 0:t.lookup_value,v_share_title:null===(u=i.data)||void 0===u?void 0:u.lookup_title}),a.AddUpdateMediaShare(null===(p=i.data)||void 0===p?void 0:p.lookup_value))}),r.present()})()}presentPopoverLookupSharePermission(n,a){var r=this;return(0,c.A)(function*(){var i;const u=yield r.popoverController.create({component:C.t,componentProps:{selectedId:null===(i=r.mediaShareUsers.find(p=>p.emailaddr==a))||void 0===i?void 0:i.v_sharepermission,lookup_key:"v_sharepermission",lookups_d2:[{lookup_value:-1,lookup_title:"X\xf3a",color:"danger"}]},event:n,dismissOnSelect:!1,animated:!1,alignment:"end",side:"bottom"});u.onDidDismiss().then(p=>{var E;"confirm"==p.role&&(r.mediaShareUsers.filter(U=>U.emailaddr==a).forEach(U=>{var R,A;Object.assign(U,{v_sharepermission:null===(R=p.data)||void 0===R?void 0:R.lookup_value,v_sharepermission_title:null===(A=p.data)||void 0===A?void 0:A.lookup_title})}),r.AddUpdateMediaShareUser(a,null===(E=p.data)||void 0===E?void 0:E.lookup_value))}),u.present()})()}GetMediaShare(){var n=this;return(0,c.A)(function*(){var a;!function g(l){l.params=l.params||{},(0,f.hm)({url:"api/MediaShare/Get",params:{getby:l.params.userid||null,mediashare_id:l.params.mediashare_id||null,media_id:l.params.media_id||null,v_share:l.params.v_share||null},success:o=>{"function"==typeof l.callback&&l.callback(o.data||null)},error:o=>{"function"==typeof l.callback&&l.callback(),console.error(o)},loading:l.loading,loadingController:l.loadingController})}({loadingController:n.loadingController,params:{userid:null===(a=n.user)||void 0===a?void 0:a.userid,media_id:n.m},callback:r=>{n.mediaShare=r||{},n.isDisabled4Only=!n.mediaShare.v_share||n.mediaShare.v_share==v.z.ONLY_ME}})})()}AddUpdateMediaShare(n){var a=this;return(0,c.A)(function*(){var r;if(!n||n<=0)return a.DeleteMediaShare();!function O(l){l.params=l.params||{},(0,f.Ll)({url:"api/MediaShare/AddUpdate",params:{media_id:l.params.media_id||null,v_share:l.params.v_share||null,createdby:l.params.userid||null,modifiedby:l.params.userid||null},success:o=>{"function"==typeof l.callback&&l.callback(o.data||null)},error:o=>{"function"==typeof l.callback&&l.callback(),console.error(o)},loading:l.loading,loadingController:l.loadingController})}({loadingController:a.loadingController,params:{userid:null===(r=a.user)||void 0===r?void 0:r.userid,media_id:a.m,v_share:n},callback:i=>{0==(null==i?void 0:i.returncode)?a.GetMediaShare():(0,h.c)(a.toastController,{},i).then(t=>t.present())}})})()}DeleteMediaShare(){var n=this;return(0,c.A)(function*(){var a;!function D(l){l.params=l.params||{},(0,f.sj)({url:"api/MediaShare/Delete",params:{deleteby:l.params.userid||null,mediashare_id:l.params.mediashare_id||null,media_id:l.params.media_id||null},success:o=>{"function"==typeof l.callback&&l.callback(o.data||null)},error:o=>{"function"==typeof l.callback&&l.callback(),console.error(o)},loading:l.loading,loadingController:l.loadingController})}({loadingController:n.loadingController,params:{userid:null===(a=n.user)||void 0===a?void 0:a.userid,media_id:n.m},callback:r=>{0==(null==r?void 0:r.returncode)?n.GetMediaShare():(0,h.c)(n.toastController,{},r).then(i=>i.present())}})})()}GetMediaShareUser(){var n=this;return(0,c.A)(function*(){var a;!function $(l){l.params=l.params||{},(0,f.hm)({url:"api/MediaShareUser/Get",params:{getby:l.params.userid||null,mediashareuser_id:l.params.mediashareuser_id||null,media_id:l.params.media_id||null,emailaddr:l.params.emailaddr||null,v_sharepermission:l.params.v_sharepermission||null},success:o=>{"function"==typeof l.callback&&l.callback(o.data||null)},error:o=>{"function"==typeof l.callback&&l.callback(),console.error(o)},loading:l.loading,loadingController:l.loadingController})}({loadingController:n.loadingController,params:{userid:null===(a=n.user)||void 0===a?void 0:a.userid,media_id:n.m},callback:r=>{n.mediaShareUsers=r||[]}})})()}AddUpdateMediaShareUser_Recursive(n){var a=this;return(0,c.A)(function*(){let r=i=>{var t;i&&F({loadingController:a.loadingController,params:{userid:null===(t=a.user)||void 0===t?void 0:t.userid,media_id:a.m,emailaddr:i,v_sharepermission:1},callback:u=>{n.length?r(null==n?void 0:n.shift()):0==(null==u?void 0:u.returncode)?a.GetMediaShareUser():(0,h.c)(a.toastController,{},u).then(p=>p.present())}})};r(n.shift())})()}AddUpdateMediaShareUser(n,a){var r=this;return(0,c.A)(function*(){var i;if(n){if(!a||a<=0)return r.DeleteMediaShareUser(n);F({loadingController:r.loadingController,params:{userid:null===(i=r.user)||void 0===i?void 0:i.userid,media_id:r.m,emailaddr:n,v_sharepermission:a},callback:t=>{0==(null==t?void 0:t.returncode)?r.GetMediaShareUser():(0,h.c)(r.toastController,{},t).then(u=>u.present())}})}})()}DeleteMediaShareUser(n){var a=this;return(0,c.A)(function*(){var r;n&&function I(l){l.params=l.params||{},(0,f.sj)({url:"api/MediaShareUser/Delete",params:{deleteby:l.params.userid||null,mediashareuser_id:l.params.mediashareuser_id||null,media_id:l.params.media_id||null,emailaddr:l.params.emailaddr||null},success:o=>{"function"==typeof l.callback&&l.callback(o.data||null)},error:o=>{"function"==typeof l.callback&&l.callback(),console.error(o)},loading:l.loading,loadingController:l.loadingController})}({loadingController:a.loadingController,params:{userid:null===(r=a.user)||void 0===r?void 0:r.userid,media_id:a.m,emailaddr:n},callback:i=>{0==(null==i?void 0:i.returncode)?a.GetMediaShareUser():(0,h.c)(a.toastController,{},i).then(t=>t.present())}})})()}copyLink(n){var a=this;return(0,c.A)(function*(){let r=a.appsettings.weburl+m._.MEDIA_VIEWER+"?m="+a.m.toString();(0,b.lW)(r)?(a.isCopiedLink=!0,a.isCopiedEmbed=!1):(0,h.c)(a.toastController,{message:"Sao ch\xe9p l\u1ed7i!"}).then(i=>i.present())})()}copyEmbed(n){var a=this;return(0,c.A)(function*(){let i=`<iframe src="${a.appsettings.weburl+m._.MEDIA_EMBED.replace(":id",a.m.toString())}" width="${a.media.width||768}" height="${a.media.height||432}" frameborder="0" allowfullscreen webkitallowfullscreen allowtransparency="true" allow="autoplay; fullscreen" style="display: block; margin: auto; border: 1px dashed rgba(0,0,0,0.1);"></iframe>`;(0,b.lW)(i)?(a.isCopiedLink=!1,a.isCopiedEmbed=!0):(0,h.c)(a.toastController,{message:"Sao ch\xe9p l\u1ed7i!"}).then(t=>t.present())})()}}return(l=o).\u0275fac=function(n){return new(n||l)(e.rXU(s.W3),e.rXU(s.IE),e.rXU(s.K_),e.rXU(s.Xi))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-modal-media-share"]],inputs:{m:"m"},decls:51,vars:26,consts:[["color","primary"],["slot","end"],["color","dark",1,"d-none","d-md-block",3,"click"],[3,"src"],["color","dark",3,"click"],["src","../../../assets/icon/16x16/close.svg"],["lines","none","detail","false","button","",3,"click"],["slot","start","name","lock-closed-outline",1,"mr-3"],[1,"d-flex","align-items-center"],[1,"mr-2"],["src","../../../assets/icon/16x16/chevron-down.svg",1,"fs-12"],[1,"fs-12","mt-1"],[1,"px-3","pt-2","pb-3"],[1,"form-group"],[1,"input-group"],["type","text","placeholder","email@example.com; email2@example.com; ...",1,"form-control",3,"change","keypress","disabled","ngModel"],[1,"input-group-append"],["type","button",1,"btn",3,"click","disabled"],[1,"mb-0","mt-3"],["button","","detail","false",3,"disabled"],[1,"p-2"],["shape","round","fill","outline",1,"m-1",3,"click"],["slot","start","src","../../../assets/icon/24x24/attach.svg",1,"fs-24"],["slot","start","src","../../../assets/icon/24x24/embed.svg",1,"fs-24"],["slot","start","name","people-outline",1,"mr-3"],["slot","start","name","globe-outline",1,"mr-3"],["onerror","errorAvatar(this)",3,"src"],[1,"ml-3"]],template:function(n,a){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"ion-text",0),e.EFF(6),e.k0s()(),e.j41(7,"ion-buttons",1)(8,"ion-button",2),e.bIt("click",function(){return a.toggleFullScreen()}),e.nrm(9,"ion-icon",3),e.k0s(),e.j41(10,"ion-button",4),e.bIt("click",function(){return a.close()}),e.nrm(11,"ion-icon",5),e.k0s()()(),e.j41(12,"ion-toolbar")(13,"ion-item",6),e.bIt("click",function(i){return a.presentPopoverLookupShare(i)}),e.DNE(14,L,1,0,"ion-icon",7)(15,G,1,0)(16,T,1,0),e.j41(17,"ion-label")(18,"div",8)(19,"b",9),e.EFF(20),e.k0s(),e.nrm(21,"ion-icon",10),e.k0s(),e.j41(22,"div",11),e.EFF(23),e.k0s()()(),e.j41(24,"div",12)(25,"div",13)(26,"div",14)(27,"input",15),e.bIt("change",function(i){return a.changeEmails(i)})("keypress",function(i){return a.keypressEmails(i)}),e.k0s(),e.j41(28,"div",16)(29,"button",17),e.bIt("click",function(i){return a.submitEmails(i)}),e.EFF(30),e.nI1(31,"translate"),e.k0s()()()(),e.nrm(32,"hr"),e.j41(33,"label",18),e.EFF(34),e.nI1(35,"translate"),e.k0s()()()(),e.j41(36,"ion-content")(37,"ion-list"),e.Z7z(38,x,5,3,"ion-item",19,e.fX1),e.k0s()(),e.j41(40,"ion-footer",20)(41,"ion-button",21),e.bIt("click",function(i){return a.copyLink(i)}),e.nrm(42,"ion-icon",22),e.j41(43,"ion-label"),e.EFF(44),e.nI1(45,"translate"),e.k0s()(),e.j41(46,"ion-button",21),e.bIt("click",function(i){return a.copyEmbed(i)}),e.nrm(47,"ion-icon",23),e.j41(48,"ion-label"),e.EFF(49),e.nI1(50,"translate"),e.k0s()()()),2&n&&(e.R7$(3),e.SpI("",e.bMT(4,16,"Share"),": "),e.R7$(3),e.JRh(a.media.media_title),e.R7$(3),e.Y8G("src",a.isfullscreen?"assets/icon/16x16/fullscreen-exit.svg":"assets/icon/16x16/fullscreen.svg"),e.R7$(5),e.vxM(14,a.mediaShare.v_share&&a.mediaShare.v_share!=a.v_share.ONLY_ME?a.mediaShare.v_share==a.v_share.ONLY_MEMBER?15:a.mediaShare.v_share==a.v_share.EVERYONE_HAS_LINK?16:-1:14),e.R7$(6),e.JRh(a.mediaShare.v_share_title),e.R7$(3),e.JRh(a.mediaShare.v_share_note),e.R7$(4),e.Y8G("disabled",!!a.isDisabled4Only)("ngModel",a.dataForm.emailaddrs),e.R7$(2),e.Y8G("disabled",!!a.isDisabled4Only),e.R7$(),e.JRh(e.bMT(31,18,"Add")),e.R7$(3),e.HbH(a.isDisabled4Only?"disabled":""),e.R7$(),e.Lme("",e.bMT(35,20,"SharedMembership")," (",a.mediaShareUsers.length,")"),e.R7$(4),e.Dyx(a.mediaShareUsers),e.R7$(6),e.JRh(e.bMT(45,22,a.isCopiedLink?"Copied":"CopyLink")),e.R7$(5),e.JRh(e.bMT(50,24,a.isCopiedEmbed?"Copied":"CopyEmbed")))},dependencies:[P.me,P.BC,P.vS,s.mC,s.Jm,s.QW,s.W9,s.M0,s.eU,s.iq,s.uz,s.he,s.nf,s.IO,s.BC,s.ai,w.D9],styles:["ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{border-radius:50%;padding:8px;margin:0 1rem 0 0;background-color:#faebd7;color:var(--ion-color-primary)}ion-toolbar[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:#f5f5f5}ion-footer[_ngcontent-%COMP%]{box-shadow:none;border:0;--box-shadow: none;--border-width: 0}ion-footer[_ngcontent-%COMP%]:before{display:none}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:234px;--border-width: 1px;--border-color: #747775;--background: transparent;--color: var(--ion-color-primary);--background-hover: var(--ion-color-primary-tint);--background-hover-opacity: 1;--color-hover: #fff;--background-focused: var(--ion-color-primary-shade);--background-focused-opacity: 1;--color-focused: #fff;--background-activated: var(--ion-color-primary);--background-activated-opacity: 1;--color-activated: #fff}.disabled[_ngcontent-%COMP%]{opacity:.65}.input-group[_ngcontent-%COMP%]{--color: #eee}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]{margin-left:.5rem}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:3rem;min-height:3rem;padding:0 1rem;border:0;border-radius:.25rem;text-align:center;line-height:0;vertical-align:middle;background-color:var(--ion-color-tertiary);color:var(--ion-color-tertiary-contrast)}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:var(--ion-color-tertiary-shade)}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .custom-select[_ngcontent-%COMP%]{height:3rem;padding:.25rem .5rem;border-color:var(--color, #4D4F60);color:var(--ion-text-color, #000);background-color:var(--ion-background-color, #fff)}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .custom-select[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#5f6ce1}.btn-share[_ngcontent-%COMP%]{padding:.25rem 0;margin:0;border:0;font-size:1rem;background-color:transparent;color:var(--ion-text-color, #000);outline:none;box-shadow:none}.btn-share[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{vertical-align:middle;font-size:1.5rem}.btn-share[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]:last-child{font-size:1rem}.btn-share[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 .5rem;vertical-align:middle}.share-member-action[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .share-member-action[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.share-member-action[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%] + ion-icon[_ngcontent-%COMP%]{margin-left:.5rem}hr[_ngcontent-%COMP%]{margin:0}"]}),o})()}}]);