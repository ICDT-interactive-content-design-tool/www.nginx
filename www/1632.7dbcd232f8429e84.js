"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1632],{1632:(Y,U,s)=>{s.d(U,{U:()=>z});var u=s(467),h=s(5972),E=s(5781),R=s(2635),C=s(3753),k=s(8408),p=s(5414),S=s(8833),y=s(4552),O=s(4668);function P(r){r.params=r.params||{},(0,h.Ll)({url:"api/MediaShareUser/AddUpdate",params:{media_id:r.params.media_id||null,emailaddr:r.params.emailaddr||null,v_sharepermission:r.params.v_sharepermission||null,createdby:r.params.userid||null,modifiedby:r.params.userid||null},success:o=>{"function"==typeof r.callback&&r.callback(o.data||null)},error:o=>{"function"==typeof r.callback&&r.callback(),console.error(o)},loading:r.loading,loadingController:r.loadingController})}var e=s(4438),d=s(6637),g=s(9417),j=s(31);function L(r,o){1&r&&e.nrm(0,"ion-icon",7)}function G(r,o){1&r&&e.nrm(0,"ion-icon",24)}function T(r,o){1&r&&e.nrm(0,"ion-icon",25)}function w(r,o){if(1&r&&(e.j41(0,"ion-item",19)(1,"ion-avatar"),e.nrm(2,"img",26),e.k0s(),e.j41(3,"ion-label",27),e.EFF(4),e.k0s()()),2&r){let f,n;const a=o.$implicit,i=e.XpG();e.Y8G("disabled",i.isDisabled4Only),e.R7$(2),e.Y8G("src",null!==(f=a.profilephoto?i.readfileuploadurl+a.profilephoto:null)&&void 0!==f?f:"../../../assets/image/user-avatar-default.png",e.B4B),e.R7$(2),e.JRh(null!==(n=a.fullname)&&void 0!==n?n:a.emailaddr)}}let z=(()=>{var r;class o{constructor(n,a,i,l){this.modalController=n,this.popoverController=a,this.toastController=i,this.loadingController=l,this.m=0,this.v_share=O.z,this.dataForm={},this.media={},this.mediaShare={},this.mediaShareUsers=[],this.isfullscreen=!1,this.readfileuploadurl="",this.fileurl="",this.appsettings={}}ngOnInit(){var n=this;this.isfullscreen=window.document.body.classList.contains("modal-fullscreen"),(0,u.A)(function*(){n.appsettings=yield(0,h.AC)(),n.appsettings.madonvi&&(n.user=yield(0,R.Nk)(),n.readfileuploadurl=n.appsettings.readfileuploadurl||"",n.refreshData())})()}refreshData(){var n;(0,E.e6)({loadingController:this.loadingController,params:{userid:null===(n=this.user)||void 0===n?void 0:n.userid,media_id:this.m},callback:a=>{this.media=a||{},this.media.media_id&&(this.GetMediaShare(),this.GetMediaShareUser())}})}toggleFullScreen(){this.isfullscreen?window.document.body.classList.remove("modal-fullscreen"):window.document.body.classList.add("modal-fullscreen"),this.isfullscreen=window.document.body.classList.contains("modal-fullscreen")}close(){return this.modalController.dismiss(null,"cancel")}changeEmails(n){var a;this.dataForm.emailaddrs=((null==n||null===(a=n.target)||void 0===a?void 0:a.value)||"").replace(/[^a-zA-Z0-9\@\;\ \-\_\.]+/g,"").replace(/\s+/," ").trim().replace(/\ \;/g,";").replace(/\;\ /g,";").replace(/\ /g,";").replace(/\;+/g,";").split(";").map(i=>{let l=i.match(/^[a-zA-Z0-9\.\-\_]+@[a-zA-Z0-9\-\_]+\.[a-zA-Z0-9\-\_]+((\.[a-zA-Z0-9\-\_]+)+)?$/);return l?l[0]:null}).filter(i=>!!i).filter((i,l,t)=>t.indexOf(i)==l).join("; ")}keypressEmails(n){var a,l,i=n.keyCode||n.which||n.charCode||0;i!=k.r_I.Enter&&i!=k.r_I.Escape||(null===(l=n.target)||void 0===l||l.blur(),this.submitEmails()),null!==(a=n.key)&&void 0!==a&&a.match(/[^a-zA-Z0-9\@\;\ \-\_\.]/)&&(null==n||n.preventDefault(),null==n||n.stopPropagation())}submitEmails(n){this.dataForm.emailaddrs&&(this.AddUpdateMediaShareUser_Recursive(this.dataForm.emailaddrs.replace(/\s+/g,"").split(";")),this.dataForm.emailaddrs="")}presentPopoverLookupShare(n){var a=this;return(0,u.A)(function*(){const i=yield a.popoverController.create({component:C.t,componentProps:{selectedId:a.mediaShare.v_share,lookup_key:"v_share"},event:n,dismissOnSelect:!1,animated:!1,side:"bottom",alignment:"start"});i.onDidDismiss().then(l=>{var t,c,m;"confirm"==l.role&&(Object.assign(a.mediaShare,{v_share:null===(t=l.data)||void 0===t?void 0:t.lookup_value,v_share_title:null===(c=l.data)||void 0===c?void 0:c.lookup_title}),a.AddUpdateMediaShare(null===(m=l.data)||void 0===m?void 0:m.lookup_value))}),i.present()})()}presentPopoverLookupSharePermission(n,a){var i=this;return(0,u.A)(function*(){var l;const c=yield i.popoverController.create({component:C.t,componentProps:{selectedId:null===(l=i.mediaShareUsers.find(m=>m.emailaddr==a))||void 0===l?void 0:l.v_sharepermission,lookup_key:"v_sharepermission",lookups_d2:[{lookup_value:-1,lookup_title:"X\xf3a",color:"danger"}]},event:n,dismissOnSelect:!1,animated:!1,alignment:"end",side:"bottom"});c.onDidDismiss().then(m=>{var v;"confirm"==m.role&&(i.mediaShareUsers.filter(_=>_.emailaddr==a).forEach(_=>{var b,M;Object.assign(_,{v_sharepermission:null===(b=m.data)||void 0===b?void 0:b.lookup_value,v_sharepermission_title:null===(M=m.data)||void 0===M?void 0:M.lookup_title})}),i.AddUpdateMediaShareUser(a,null===(v=m.data)||void 0===v?void 0:v.lookup_value))}),c.present()})()}GetMediaShare(){var n=this;return(0,u.A)(function*(){var a;!function A(r){r.params=r.params||{},(0,h.hm)({url:"api/MediaShare/Get",params:{getby:r.params.userid||null,mediashare_id:r.params.mediashare_id||null,media_id:r.params.media_id||null,v_share:r.params.v_share||null},success:o=>{"function"==typeof r.callback&&r.callback(o.data||null)},error:o=>{"function"==typeof r.callback&&r.callback(),console.error(o)},loading:r.loading,loadingController:r.loadingController})}({loadingController:n.loadingController,params:{userid:null===(a=n.user)||void 0===a?void 0:a.userid,media_id:n.m},callback:i=>{n.mediaShare=i||{},n.isDisabled4Only=!n.mediaShare.v_share||n.mediaShare.v_share==O.z.ONLY_ME}})})()}AddUpdateMediaShare(n){var a=this;return(0,u.A)(function*(){var i;if(!n||n<=0)return a.DeleteMediaShare();!function F(r){r.params=r.params||{},(0,h.Ll)({url:"api/MediaShare/AddUpdate",params:{media_id:r.params.media_id||null,v_share:r.params.v_share||null,createdby:r.params.userid||null,modifiedby:r.params.userid||null},success:o=>{"function"==typeof r.callback&&r.callback(o.data||null)},error:o=>{"function"==typeof r.callback&&r.callback(),console.error(o)},loading:r.loading,loadingController:r.loadingController})}({loadingController:a.loadingController,params:{userid:null===(i=a.user)||void 0===i?void 0:i.userid,media_id:a.m,v_share:n},callback:l=>{0==(null==l?void 0:l.returncode)?a.GetMediaShare():(0,p.c)(a.toastController,{},l).then(t=>t.present())}})})()}DeleteMediaShare(){var n=this;return(0,u.A)(function*(){var a;!function D(r){r.params=r.params||{},(0,h.sj)({url:"api/MediaShare/Delete",params:{deleteby:r.params.userid||null,mediashare_id:r.params.mediashare_id||null,media_id:r.params.media_id||null},success:o=>{"function"==typeof r.callback&&r.callback(o.data||null)},error:o=>{"function"==typeof r.callback&&r.callback(),console.error(o)},loading:r.loading,loadingController:r.loadingController})}({loadingController:n.loadingController,params:{userid:null===(a=n.user)||void 0===a?void 0:a.userid,media_id:n.m},callback:i=>{0==(null==i?void 0:i.returncode)?n.GetMediaShare():(0,p.c)(n.toastController,{},i).then(l=>l.present())}})})()}GetMediaShareUser(){var n=this;return(0,u.A)(function*(){var a;!function I(r){r.params=r.params||{},(0,h.hm)({url:"api/MediaShareUser/Get",params:{getby:r.params.userid||null,mediashareuser_id:r.params.mediashareuser_id||null,media_id:r.params.media_id||null,emailaddr:r.params.emailaddr||null,v_sharepermission:r.params.v_sharepermission||null},success:o=>{"function"==typeof r.callback&&r.callback(o.data||null)},error:o=>{"function"==typeof r.callback&&r.callback(),console.error(o)},loading:r.loading,loadingController:r.loadingController})}({loadingController:n.loadingController,params:{userid:null===(a=n.user)||void 0===a?void 0:a.userid,media_id:n.m},callback:i=>{n.mediaShareUsers=i||[]}})})()}AddUpdateMediaShareUser_Recursive(n){var a=this;return(0,u.A)(function*(){let i=l=>{var t;l&&P({loadingController:a.loadingController,params:{userid:null===(t=a.user)||void 0===t?void 0:t.userid,media_id:a.m,emailaddr:l,v_sharepermission:1},callback:c=>{n.length?i(null==n?void 0:n.shift()):0==(null==c?void 0:c.returncode)?a.GetMediaShareUser():(0,p.c)(a.toastController,{},c).then(m=>m.present())}})};i(n.shift())})()}AddUpdateMediaShareUser(n,a){var i=this;return(0,u.A)(function*(){var l;if(n){if(!a||a<=0)return i.DeleteMediaShareUser(n);P({loadingController:i.loadingController,params:{userid:null===(l=i.user)||void 0===l?void 0:l.userid,media_id:i.m,emailaddr:n,v_sharepermission:a},callback:t=>{0==(null==t?void 0:t.returncode)?i.GetMediaShareUser():(0,p.c)(i.toastController,{},t).then(c=>c.present())}})}})()}DeleteMediaShareUser(n){var a=this;return(0,u.A)(function*(){var i;n&&function $(r){r.params=r.params||{},(0,h.sj)({url:"api/MediaShareUser/Delete",params:{deleteby:r.params.userid||null,mediashareuser_id:r.params.mediashareuser_id||null,media_id:r.params.media_id||null,emailaddr:r.params.emailaddr||null},success:o=>{"function"==typeof r.callback&&r.callback(o.data||null)},error:o=>{"function"==typeof r.callback&&r.callback(),console.error(o)},loading:r.loading,loadingController:r.loadingController})}({loadingController:a.loadingController,params:{userid:null===(i=a.user)||void 0===i?void 0:i.userid,media_id:a.m,emailaddr:n},callback:l=>{0==(null==l?void 0:l.returncode)?a.GetMediaShareUser():(0,p.c)(a.toastController,{},l).then(t=>t.present())}})})()}copyLink(n){var a=this;return(0,u.A)(function*(){let i=a.appsettings.weburl+S._.MEDIA_VIEWER+"?m="+a.m.toString();(0,y.lW)(i)?(a.isCopiedLink=!0,a.isCopiedEmbed=!1):(0,p.c)(a.toastController,{message:"Sao ch\xe9p l\u1ed7i!"}).then(l=>l.present())})()}copyEmbed(n){var a=this;return(0,u.A)(function*(){let l=`<iframe src="${a.appsettings.weburl+S._.MEDIA_EMBED.replace(":id",a.m.toString())}" width="${a.media.width||768}" height="${a.media.height||432}" frameborder="0" allowfullscreen webkitallowfullscreen allowtransparency="true" allow="autoplay; fullscreen" style="display: block; margin: auto; border: 1px dashed rgba(0,0,0,0.1);"></iframe>`;(0,y.lW)(l)?(a.isCopiedLink=!1,a.isCopiedEmbed=!0):(0,p.c)(a.toastController,{message:"Sao ch\xe9p l\u1ed7i!"}).then(t=>t.present())})()}}return(r=o).\u0275fac=function(n){return new(n||r)(e.rXU(d.W3),e.rXU(d.IE),e.rXU(d.K_),e.rXU(d.Xi))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-modal-media-share"]],inputs:{m:"m"},decls:51,vars:26,consts:[["color","primary"],["slot","end"],["color","dark",1,"d-none","d-md-block",3,"click"],[3,"src"],["color","dark",3,"click"],["src","../../../assets/icon/16x16/close.svg"],["lines","none","detail","false","button","",3,"click"],["slot","start","name","lock-closed-outline",1,"mr-3"],[1,"d-flex","align-items-center"],[1,"mr-2"],["src","../../../assets/icon/16x16/chevron-down.svg",1,"fs-12"],[1,"fs-12","mt-1"],[1,"px-3","pt-2","pb-3"],[1,"form-group"],[1,"input-group"],["type","text","placeholder","email@example.com; email2@example.com; ...",1,"form-control",3,"change","keypress","disabled","ngModel"],[1,"input-group-append"],["type","button",1,"btn",3,"click","disabled"],[1,"mb-0","mt-3"],["button","","detail","false",3,"disabled"],[1,"p-2"],["shape","round","fill","outline",1,"m-1",3,"click"],["slot","start","src","../../../assets/icon/24x24/attach.svg",1,"fs-24"],["slot","start","src","../../../assets/icon/24x24/embed.svg",1,"fs-24"],["slot","start","name","people-outline",1,"mr-3"],["slot","start","name","globe-outline",1,"mr-3"],["onerror","errorAvatar(this)",3,"src"],[1,"ml-3"]],template:function(n,a){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"ion-text",0),e.EFF(6),e.k0s()(),e.j41(7,"ion-buttons",1)(8,"ion-button",2),e.bIt("click",function(){return a.toggleFullScreen()}),e.nrm(9,"ion-icon",3),e.k0s(),e.j41(10,"ion-button",4),e.bIt("click",function(){return a.close()}),e.nrm(11,"ion-icon",5),e.k0s()()(),e.j41(12,"ion-toolbar")(13,"ion-item",6),e.bIt("click",function(l){return a.presentPopoverLookupShare(l)}),e.DNE(14,L,1,0,"ion-icon",7)(15,G,1,0)(16,T,1,0),e.j41(17,"ion-label")(18,"div",8)(19,"b",9),e.EFF(20),e.k0s(),e.nrm(21,"ion-icon",10),e.k0s(),e.j41(22,"div",11),e.EFF(23),e.k0s()()(),e.j41(24,"div",12)(25,"div",13)(26,"div",14)(27,"input",15),e.bIt("change",function(l){return a.changeEmails(l)})("keypress",function(l){return a.keypressEmails(l)}),e.k0s(),e.j41(28,"div",16)(29,"button",17),e.bIt("click",function(l){return a.submitEmails(l)}),e.EFF(30),e.nI1(31,"translate"),e.k0s()()()(),e.nrm(32,"hr"),e.j41(33,"label",18),e.EFF(34),e.nI1(35,"translate"),e.k0s()()()(),e.j41(36,"ion-content")(37,"ion-list"),e.Z7z(38,w,5,3,"ion-item",19,e.fX1),e.k0s()(),e.j41(40,"ion-footer",20)(41,"ion-button",21),e.bIt("click",function(l){return a.copyLink(l)}),e.nrm(42,"ion-icon",22),e.j41(43,"ion-label"),e.EFF(44),e.nI1(45,"translate"),e.k0s()(),e.j41(46,"ion-button",21),e.bIt("click",function(l){return a.copyEmbed(l)}),e.nrm(47,"ion-icon",23),e.j41(48,"ion-label"),e.EFF(49),e.nI1(50,"translate"),e.k0s()()()),2&n&&(e.R7$(3),e.SpI("",e.bMT(4,16,"Share"),": "),e.R7$(3),e.JRh(a.media.media_title),e.R7$(3),e.Y8G("src",a.isfullscreen?"assets/icon/16x16/fullscreen-exit.svg":"assets/icon/16x16/fullscreen.svg"),e.R7$(5),e.vxM(14,a.mediaShare.v_share&&a.mediaShare.v_share!=a.v_share.ONLY_ME?a.mediaShare.v_share==a.v_share.ONLY_MEMBER?15:a.mediaShare.v_share==a.v_share.EVERYONE_HAS_LINK?16:-1:14),e.R7$(6),e.JRh(a.mediaShare.v_share_title),e.R7$(3),e.JRh(a.mediaShare.v_share_note),e.R7$(4),e.Y8G("disabled",!!a.isDisabled4Only)("ngModel",a.dataForm.emailaddrs),e.R7$(2),e.Y8G("disabled",!!a.isDisabled4Only),e.R7$(),e.JRh(e.bMT(31,18,"Add")),e.R7$(3),e.HbH(a.isDisabled4Only?"disabled":""),e.R7$(),e.Lme("",e.bMT(35,20,"SharedMembership")," (",a.mediaShareUsers.length,")"),e.R7$(4),e.Dyx(a.mediaShareUsers),e.R7$(6),e.JRh(e.bMT(45,22,a.isCopiedLink?"Copied":"CopyLink")),e.R7$(5),e.JRh(e.bMT(50,24,a.isCopiedEmbed?"Copied":"CopyEmbed")))},dependencies:[g.me,g.BC,g.vS,d.mC,d.Jm,d.QW,d.W9,d.M0,d.eU,d.iq,d.uz,d.he,d.nf,d.IO,d.BC,d.ai,j.D9],styles:["ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{border-radius:50%;padding:8px;margin:0 1rem 0 0;background-color:#faebd7;color:var(--ion-color-primary)}ion-toolbar[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:#f5f5f5}ion-footer[_ngcontent-%COMP%]{box-shadow:none;border:0;--box-shadow: none;--border-width: 0}ion-footer[_ngcontent-%COMP%]:before{display:none}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:234px;--border-width: 1px;--border-color: #747775;--background: transparent;--color: var(--ion-color-primary);--background-hover: var(--ion-color-primary-tint);--background-hover-opacity: 1;--color-hover: #fff;--background-focused: var(--ion-color-primary-shade);--background-focused-opacity: 1;--color-focused: #fff;--background-activated: var(--ion-color-primary);--background-activated-opacity: 1;--color-activated: #fff}.disabled[_ngcontent-%COMP%]{opacity:.65}.input-group[_ngcontent-%COMP%]{--color: #eee}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]{margin-left:.5rem}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:3rem;min-height:3rem;padding:0 1rem;border:0;border-radius:.25rem;text-align:center;line-height:0;vertical-align:middle;background-color:var(--ion-color-tertiary);color:var(--ion-color-tertiary-contrast)}.input-group[_ngcontent-%COMP%]   .input-group-append[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:var(--ion-color-tertiary-shade)}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .custom-select[_ngcontent-%COMP%]{height:3rem;padding:.25rem .5rem;border-color:var(--color, #4D4F60);color:var(--ion-text-color, #000);background-color:var(--ion-background-color, #fff)}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   .custom-select[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#5f6ce1}.btn-share[_ngcontent-%COMP%]{padding:.25rem 0;margin:0;border:0;font-size:1rem;background-color:transparent;color:var(--ion-text-color, #000);outline:none;box-shadow:none}.btn-share[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{vertical-align:middle;font-size:1.5rem}.btn-share[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]:last-child{font-size:1rem}.btn-share[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin:0 .5rem;vertical-align:middle}.share-member-action[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .share-member-action[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.share-member-action[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%] + ion-icon[_ngcontent-%COMP%]{margin-left:.5rem}hr[_ngcontent-%COMP%]{margin:0}"]}),o})()}}]);